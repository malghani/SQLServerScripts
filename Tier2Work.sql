
Select Partner, ADMPSTDAT, AGMPRGCOD, SUM(Amt) FROM dbo.SalesDisbData 
Where ADMACCCOD='0000077124'
Group by Partner, ADMPSTDAT, AGMPRGCOD

Select COUNT(*) From SalesDisbData Where prdsts in ('VOID', 'Denied') AND Admdistyp='RESV'
Select * From SalesDisbData

Select Gross=Sum(CASE WHEN ADMTRNTYP='CUR' AND ADMPSTDAT=AGMPSTDAT THEN Amt ELSE 0 END),
	   Net=Sum(Amt) 
FROM dbo.SalesDisbData 
WHERE PRDSTS IN ('INFORCE','CANCELLED','EXPIRED')



							
Select * FROM dbo.Claims 



Select COUNT(*) FROM dbo.ClaimSummary





exec master.dbo.sp_WhoIsActive



  
 
UPDATE S Set ProductType=[Type], ProductCategory=Category, ProductName=M.ProductName, [Partner]=M.[Partner], Coverage=M.Coverage
--Select distinct M.Partner, S.Partner, S.PRoductCategory, M.Category ,M.Type, M.ProductName, M.CLICOD, M.CPROG, M.CPROD, M.CPLAN, S.ADMCLICOD, S.AGMPRGCOD, S.ADMPRDCOD, S.AGDPLNCOD,  S.ProductCategory, S.ProductType,S.ProductName							
from SalesDisbData S							
INNER JOIN MasterProductMatrix M ON ltrim(rtrim(S.ADMCLICOD))=ltrim(rtrim(M.CLICOD)) AND ltrim(rtrim(S.AGMPRGCOD))=ltrim(rtrim(M.CPROG)) AND ltrim(rtrim(S.ADMPRDCOD))=ltrim(rtrim(M.CPROD)) AND ltrim(rtrim(S.AGDPLNCOD))=ltrim(rtrim(M.CPLAN))
WHERE 

UPDATE SalesDisbData Set [Partner]='Santander' WHERE NOT [Partner] IS NULL


UPDATE MasterProductMatrix SET CLICOD=ltrim(rtrim(CLICOD)), CPROG=ltrim(rtrim(CPROG)) ,CPROD=ltrim(rtrim(CPROD)) ,CPLAN=ltrim(rtrim(CPLAN))




------------------------ 




---------- Disbursements and Reserves

SELECT  D.ADMCLICOD, D.ADMACCCOD, D.ADMAGRCOD, D.ADMAGRSFX, D.ADMEFRTYN, 
								D.ADMTRNTYP,D.ADMDISTYP, D.ADMDISCOD, D.ADMDISAMT,
								A.AGMPRGCOD, D.ADMPRDCOD, PLN.APVALPVAL AGDPLNCOD,P.APVALPVAL PRDSTS, TERM.APVNUMVAL TERM,
								A.AGMPSTDAT, D.ADMPSTDAT,D.ADMENTDAT, D.ADMEFFDAT, D.ADMRECDAT,
								ADDR.AADREGION
						--Select * into  SalesDisbDataOld from      drop table SalesDisbData      
						INTO SalesDisbData      
							  FROM I400DASQL.EFGAS400.SESCSEFG.SCAGRM A

							  INNER JOIN I400DASQL.EFGAS400.SESCSEFG.SCAGRPVM p
															ON a.AGMCLICOD = p.APVCLICOD and
																  a.AGMACCCOD = p.APVACCCOD and
																  a.AGMAGRCOD = p.APVAGRCOD and
																  a.AGMAGRSFX = p.APVAGRSFX AND p.APVFLDCOD = '~MVPRDSTS'
																 -- AND p.APVALPVAL IN('INFORCE','CANCELLED','EXPIRED')
							  INNER JOIN I400DASQL.EFGAS400.SESCSEFG.SCAGRPVM PLN
															ON a.AGMCLICOD = PLN.APVCLICOD and
																  a.AGMACCCOD = PLN.APVACCCOD and
																  a.AGMAGRCOD = PLN.APVAGRCOD and
																  a.AGMAGRSFX = PLN.APVAGRSFX AND PLN.APVFLDCOD = '~MVPLNCOD'
							  INNER JOIN I400DASQL.EFGAS400.SESCSEFG.SCAGRPVM TERM
															ON a.AGMCLICOD = TERM.APVCLICOD and
																  a.AGMACCCOD = TERM.APVACCCOD and
																  a.AGMAGRCOD = TERM.APVAGRCOD and
																  a.AGMAGRSFX = TERM.APVAGRSFX AND TERM.APVFLDCOD = '~MVTRMTIM'
																  
							INNER JOIN I400DASQL.EFGAS400.SESCSEFG.SCAGRPVM V
															ON a.AGMCLICOD = V.APVCLICOD and
																  a.AGMACCCOD = V.APVACCCOD and
																  a.AGMAGRCOD = V.APVAGRCOD and
																  a.AGMAGRSFX = V.APVAGRSFX AND V.APVFLDCOD = '~MVNWUSNA'		


							  INNER JOIN (SELECT  AADACCCOD, AADREGION FROM I400DASQL.EFGAS400.SESCSEFG.SCALTADR 
										  Group By AADACCCOD, AADREGION) AS ADDR ON ADDR.AADACCCOD=AGMACCCOD
							  
	  							  INNER JOIN I400DASQL.EFGAS400.SESCSEFG.SCAGRDM D
										ON  a.AGMCLICOD = d.ADMCLICOD and
										  a.AGMACCCOD = d.ADMACCCOD and
										  a.AGMAGRCOD = d.ADMAGRCOD and
										  a.AGMAGRSFX = d.ADMAGRSFX

							  WHERE ADMEFRTYN = 'Y' 
							 AND ADMPSTDAT=20130731

--

Select count(*) From SalesDisbData 
WHERE ADMACCCOD='0000077813' and ADMDISTYP='RESV' AND AGMPRGCOD='KK79'

-------------------  Claims and Earnings


SELECT  COUNT(*) FROM I400DASQL.EFGAS400.SESCSEFG.SCAGREP AEP
INNER JOIN I400DASQL.EFGAS400.SESCSEFG.SCPAYRD PRD
           ON PRDCLICOD=AEPCLICOD  AND PRDACCCOD=AEPACCCOD AND PRDAGRCOD=AEPAGRCOD AND PRDAGRSFX=AEPAGRSFX 
           AND PRDPAYSTS='P'
WHERE  AEPACCCOD IN
		  ('0000026514',	'0000026939',	'0000027355',	'0000027356',	'0000027357',	
							   '0000029583',	'0000031697',	'0000031704',	'0000077813',	'0000077814',	
							   '0000077876',	'0000078457',	'0000078495',	'0000078838',	'0000079263',	
							   '0000079495',	'0000079989',	'0000081562',	'0000081844',	'0000082728',	
							   '0000082998',	'0000083457',	'0000083524',	'0000083968',	'0000084497',	
							   '0000084681',	'0000084845',	'0000087725',	'0000089596',	'0000090128',	
							   '0000090676',	'0000090700',	'0000090795',	'0000091067',	'0000091070',	
							   '0000091088',	'0000091354',	'0000091701',	'0000091829',	'0000091832',	
							   '0000091997',	'0000092011',	'0000092031',	'0000092060',	'0000092195',	
							   '0000092346',	'0000092456',	'0000026110',	'0000077059',	'0000077124',	
							   '0000090683',	'0000092474',	'0000025501',	'0000025502',	'0000025571')




SELECT * INTO ClaimsReserves FROM I400DASQL.EFGAS400.SESCSEFG.SCAGREP AEP
LEFT JOIN I400DASQL.EFGAS400.SESCSEFG.SCPAYRD PRD
           ON PRDCLICOD=AEPCLICOD  AND PRDACCCOD=AEPACCCOD AND PRDAGRCOD=AEPAGRCOD AND PRDAGRSFX=AEPAGRSFX 
           AND PRDPRTDAT BETWEEN 20131201 AND 20131231  
WHERE AEPYRMON=201312 

Select MAX(AEPYRMON), MIN(AEPYRMON) FROM I400DASQL.EFGAS400.SESCSEFG.SCAGREP
WHERE AEPYRMON<=0

Select * from ClaimsReserves WHERE ltrim(rtrim(PRDAGRCOD))='0000199'

Select AEPCLICOD, AEPACCCOD, AEPPRGCOD, AEPPLNCOD, [Claim Counts]=COUNT(distinct PRDCLMTID), 
			[Claim Payments]=SUM(ISNULL(PRDCHKAMT,0)), Contracts=count(Distinct PRDAGRCOD),
			[Earned Reserves Month] = SUM(ISNULL(AEPERNCM,0)),
			[Earned Reserves ITD] = SUM(ISNULL(AEPERNITD,0))
FROM ClaimsReserves
WHERE AEPACCCOD='0000027357' AND AEPPRGCOD='KK79'
Group by AEPCLICOD, AEPACCCOD, AEPPRGCOD, AEPPLNCOD

Select * FROM I400DASQL.EFGAS400.SESCSEFG.SCDPLRF WHERE PRTPSTDAT=20131231 AND PRTACCCOD='0000027357' AND PRTPRGCOD='KK79'
Select * FROM I400DASQL.EFGAS400.SESCSEFG.SCDPLRF WHERE PRTPSTDAT=20130731 AND PRTACCCOD='0000077813' AND PRTPRGCOD='KK79'




Select * FROM 
(Select PRDAGRCOD, ct=count(*) From ClaimsReserves Group by PRDAGRCOD) PRD
INNER JOIN (Select AEPAGRCOD, ct=count(*) From ClaimsReserves Group by  AEPAGRCOD) AEP ON AEP.AEPAGRCOD=PRD.PRDAGRCOD
--WHERE PRD.ct<>AEP.ct

----------------------------------------------


Select COUNT(*) FROM I400DASQL.EFGAS400.SESCSEFG.SCAGRDM WHERE aDMPSTDAT<20080131

Select COUNT(*) From dbo.SAL002_Tier1_Sales

exec master.dbo.sp_whoisactive
kill 433
Select count(*) From [SalesDisbDataHist](NOLOCK)